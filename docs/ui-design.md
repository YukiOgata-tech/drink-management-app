# UI設計ドキュメント

## 設計方針

### ターゲットユーザー
- 学生・若者層
- 友達と飲み会を楽しむグループ

### デザインコンセプト
- **楽しさ優先**: 学生ノリで楽しめる
- **競争心を刺激**: ランキングで盛り上がる
- **分かりやすさ**: 直感的な操作
- **信頼性**: データの正確性を担保
- **カジュアル**: 堅苦しくない、親しみやすいUI

### カラーパレット
- **Primary**: Sky Blue (#0ea5e9) - 爽やかで楽しいイメージ
- **Secondary**: Orange/Amber - 活気、エネルギー
- **Success**: Green - 承認完了
- **Warning**: Yellow - 承認待ち
- **Danger**: Red - 危険、削除

---

## 画面構成

### 既存画面
1. ホーム (`app/(tabs)/index.tsx`)
2. 飲酒記録 (`app/(tabs)/drinks.tsx`) - 日常の記録
3. イベント一覧 (`app/(tabs)/events.tsx`)
4. プロフィール (`app/(tabs)/profile.tsx`)

### 新規追加画面
1. **イベント作成** (`app/(tabs)/events/create.tsx`)
2. **イベント詳細** (`app/(tabs)/events/[id]/index.tsx`)
3. **飲酒記録追加（イベント用）** (`app/(tabs)/events/[id]/add-drink.tsx`)
4. **承認待ち一覧** (`app/(tabs)/events/[id]/approvals.tsx`)
5. **ランキング** (`app/(tabs)/events/[id]/ranking.tsx`)

---

## ナビゲーションフロー

```
ホーム
└─ イベント一覧
   ├─ イベント作成 → イベント詳細
   └─ イベント詳細
      ├─ 飲酒記録追加
      ├─ 承認待ち一覧（consensusモードのみ）
      └─ ランキング
```

---

## 画面詳細設計

## 1. イベント一覧画面 (`events.tsx`)

### 目的
- 参加中・終了済みイベントの一覧表示
- 新規イベント作成への導線

### レイアウト

```
┌─────────────────────────────────────┐
│ 🎉 イベント                    [+]  │
├─────────────────────────────────────┤
│ 📍 開催中 (2)                        │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🍻 新歓コンパ 2026              │ │
│ │ 👥 5人参加中                     │ │
│ │ 📊 記録ルール: 同意制           │ │
│ │ ⏱ 2時間前〜                     │ │
│ │ ─────────────────────────────   │ │
│ │ 🥇 1位: 田中 (8杯)              │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🎊 忘年会                       │ │
│ │ 👥 12人参加中                   │ │
│ │ 📊 記録ルール: 個人管理         │ │
│ │ ⏱ 30分前〜                      │ │
│ └─────────────────────────────────┘ │
│                                     │
├─────────────────────────────────────┤
│ 📦 終了済み (5)                      │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🎉 卒業パーティー               │ │
│ │ 👥 8人参加                       │ │
│ │ 🏆 MVP: 佐藤 (15杯)             │ │
│ │ 📅 2週間前                       │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### コンポーネント構成
- **ヘッダー**: タイトル + 作成ボタン
- **開催中セクション**:
  - リアルタイム情報（参加人数、1位）
  - タップでイベント詳細へ
- **終了済みセクション**:
  - MVP表示
  - タップで結果詳細へ

### インタラクション
- 右上の`[+]`ボタン → イベント作成画面へ
- イベントカードタップ → イベント詳細画面へ
- 長押し → メニュー表示（退出、削除など）

---

## 2. イベント作成画面 (`events/create.tsx`)

### 目的
- 新規イベントの作成
- 記録ルールの選択

### レイアウト

```
┌─────────────────────────────────────┐
│ [<] イベント作成             [完了] │
├─────────────────────────────────────┤
│                                     │
│ イベント名 *                         │
│ ┌─────────────────────────────────┐ │
│ │ 🎉 新歓コンパ 2026              │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 説明（任意）                         │
│ ┌─────────────────────────────────┐ │
│ │ 1年生歓迎の飲み会！             │ │
│ │                                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 記録ルール *                         │
│ ┌─────────────────────────────────┐ │
│ │ ○ 個人管理                      │ │
│ │   各自が自由に記録              │ │
│ ├─────────────────────────────────┤ │
│ │ ○ 管理者記録管理                │ │
│ │   管理者のみ記録可能            │ │
│ ├─────────────────────────────────┤ │
│ │ ● ユーザー間同意制              │ │
│ │   他の参加者の承認が必要        │ │
│ │                                 │ │
│ │   必要な承認数: [1] 人以上      │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 開始時刻                             │
│ ┌─────────────────────────────────┐ │
│ │ 📅 2026/01/20  ⏰ 18:00        │ │
│ └─────────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘
```

### フォーム項目
1. **イベント名** (必須)
   - プレースホルダー: 「例: 新歓コンパ 2026」

2. **説明** (任意)
   - 複数行テキスト

3. **記録ルール** (必須)
   - ラジオボタン形式
   - 各ルールに説明を表示
   - **同意制を選択時**: 必要承認数の入力欄が表示

4. **開始時刻** (必須)
   - デフォルト: 現在時刻
   - DateTimePicker使用

### バリデーション
- イベント名: 1〜50文字
- 必要承認数: 1以上の整数

### 完了アクション
1. イベント作成
2. 自分をホストとして`event_members`に追加
3. イベント詳細画面へ遷移

---

## 3. イベント詳細画面 (`events/[id]/index.tsx`)

### 目的
- イベント情報の表示
- 参加者一覧
- 飲酒記録の一覧表示
- 各種アクションへの導線

### レイアウト（開催中）

```
┌─────────────────────────────────────┐
│ [<] 新歓コンパ 2026            [⋮]  │
├─────────────────────────────────────┤
│ ⏱ 開催中 (2時間15分経過)            │
│ 📊 記録ルール: ユーザー間同意制      │
│ 👤 ホスト: 田中太郎                 │
├─────────────────────────────────────┤
│                                     │
│ 👥 参加者 (5人)            [招待+]  │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🥇 田中 📊 8杯 (160g)  👍 ホスト │ │
│ │ 🥈 佐藤 📊 7杯 (140g)            │ │
│ │ 🥉 鈴木 📊 6杯 (120g)            │ │
│ │    山田 📊 4杯 (80g)             │ │
│ │    高橋 📊 3杯 (60g)             │ │
│ └─────────────────────────────────┘ │
│                                     │
├─────────────────────────────────────┤
│ 📝 飲酒記録                          │
│                                     │
│ ⚠️ 承認待ち 3件  [確認する >]        │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🍺 田中 - 生ビール(中) x1       │ │
│ │ 💬 「乾杯！」                   │ │
│ │ ✅ 承認済み  ⏰ 18:05           │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🥃 佐藤 - ハイボール x2         │ │
│ │ 💬 「調子いいぞ」               │ │
│ │ ⏳ 承認待ち (1/1)  ⏰ 18:12     │ │
│ └─────────────────────────────────┘ │
│                                     │
│          [さらに表示]                │
│                                     │
├─────────────────────────────────────┤
│ [🍺 記録追加]  [🏆 ランキング]      │
└─────────────────────────────────────┘
```

### セクション

#### 1. ヘッダー情報
- イベント名
- ステータス（開催中 / 終了済み）
- 経過時間（開催中の場合）
- 記録ルール
- ホスト名

#### 2. 参加者セクション
- リアルタイム順位表示
- 杯数と純アルコール量
- ホスト・マネージャーのバッジ
- 招待ボタン（後ほど実装）

#### 3. 飲酒記録セクション
- 承認待ち件数（consensusモードのみ）
- タイムライン形式の記録一覧
- 各記録にメモとステータス表示
- 承認数の表示（consensus）

#### 4. アクションボタン
- **記録追加**: 飲酒記録追加画面へ
- **ランキング**: ランキング画面へ

### 権限別の表示
- **ホスト**: 全機能 + イベント終了ボタン
- **マネージャー**: 記録追加（host_onlyの場合）
- **メンバー**: 閲覧 + 自分の記録追加（ルールに応じて）

---

## 4. 飲酒記録追加画面 (`events/[id]/add-drink.tsx`)

### 目的
- イベント中の飲酒記録を追加
- 記録ルールに応じた動作

### レイアウト（selfモード）

```
┌─────────────────────────────────────┐
│ [<] 記録追加                   [完了]│
├─────────────────────────────────────┤
│                                     │
│ ドリンクを選択                       │
│                                     │
│ [検索: ビール...]                    │
│                                     │
│ 🍺 ビール                            │
│ ┌───┬───┬───┬───┐                   │
│ │🍺 │🍺 │🍺 │🥃 │                   │
│ │生中│生大│瓶  │ハイ│                   │
│ └───┴───┴───┴───┘                   │
│                                     │
│ 選択中: 生ビール(中ジョッキ)         │
│ 📏 435ml  🌡 5%  ⚗️ 17.2g          │
│                                     │
│ 杯数                                 │
│ ┌─────────────────────────────────┐ │
│ │      [−]   2杯   [+]           │ │
│ └─────────────────────────────────┘ │
│                                     │
│ メモ（任意）                         │
│ ┌─────────────────────────────────┐ │
│ │ めっちゃ美味い！                │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ─────────────────────────────────   │
│                                     │
│ 合計: 34.4g                         │
│                                     │
└─────────────────────────────────────┘
```

### レイアウト（host_onlyモード・管理者の場合）

```
┌─────────────────────────────────────┐
│ [<] 記録追加                   [完了]│
├─────────────────────────────────────┤
│                                     │
│ 記録対象 *                           │
│ ┌─────────────────────────────────┐ │
│ │ 👤 佐藤次郎              [変更]  │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ドリンクを選択                       │
│ [検索: ...]                          │
│                                     │
│ （以下は同じ）                       │
│                                     │
└─────────────────────────────────────┘
```

### 入力項目

1. **記録対象** (host_onlyモードの管理者のみ)
   - 参加者リストから選択
   - デフォルト: 前回選択したユーザー

2. **ドリンク選択**
   - カテゴリフィルター
   - 検索機能
   - プリセットドリンクをグリッド表示
   - タップで選択

3. **杯数**
   - ステッパー（−/+ボタン）
   - 初期値: 1杯
   - 範囲: 1〜99

4. **メモ**
   - 任意入力
   - プレースホルダー: 「気分や状況をメモ」
   - 最大200文字

### 完了アクション
- **selfモード**: 即座に確定（status=approved）
- **host_onlyモード**: 即座に確定
- **consensusモード**: 承認待ち（status=pending）
- 成功メッセージ表示
- イベント詳細画面に戻る

---

## 5. 承認待ち一覧画面 (`events/[id]/approvals.tsx`)

### 目的
- consensusモードで承認待ちの記録を一覧表示
- 承認・却下のアクション

### レイアウト

```
┌─────────────────────────────────────┐
│ [<] 承認待ち                         │
├─────────────────────────────────────┤
│ ⚠️ 承認が必要な記録 (3件)            │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 👤 佐藤次郎                      │ │
│ │ 🥃 ハイボール x2                 │ │
│ │ 💬 「調子いいぞ」                │ │
│ │ ⏰ 18:12 (5分前)                 │ │
│ │                                 │ │
│ │ 承認状況: 1/1                    │ │
│ │ あと0人の承認で確定！            │ │
│ │                                 │ │
│ │ [✅ 承認する]      [❌ 却下]     │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 👤 鈴木三郎                      │ │
│ │ 🍺 生ビール(大) x1               │ │
│ │ 💬 「一気！」                   │ │
│ │ ⏰ 18:08 (9分前)                 │ │
│ │                                 │ │
│ │ 承認状況: 0/1                    │ │
│ │ あと1人の承認が必要              │ │
│ │                                 │ │
│ │ [✅ 承認する]      [❌ 却下]     │ │
│ └─────────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ ✅ 承認済み (12件)                   │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 👤 田中太郎 - 生ビール(中) x1   │ │
│ │ ✅ あなたが承認  ⏰ 18:05        │ │
│ └─────────────────────────────────┘ │
│                                     │
└─────────────────────────────────────┘
```

### セクション

#### 1. 承認待ちセクション
- 承認が必要な記録を新しい順に表示
- 各カードに：
  - ユーザー名、ドリンク情報、メモ
  - 記録時刻
  - 承認状況（X/Y形式）
  - 残り承認数のメッセージ
  - 承認・却下ボタン

#### 2. 承認済みセクション
- 自分が承認した記録
- 確認用（取り消しも可能）

### インタラクション
- **承認ボタン**:
  - `drink_log_approvals`にレコード追加
  - トリガーで自動判定
  - 必要数に達したら即座に承認済みに

- **却下ボタン**:
  - 確認ダイアログ表示
  - `status`を`rejected`に変更
  - 記録者に通知（後ほど実装）

### 制約
- 自分の記録は表示されない（承認できないため）
- pending状態の記録のみ表示

---

## 6. ランキング画面 (`events/[id]/ranking.tsx`)

### 目的
- 参加者の記録を比較
- 楽しく競争心を刺激
- 「誰が一番強いか」を可視化

### レイアウト

```
┌─────────────────────────────────────┐
│ [<] ランキング                 [共有]│
├─────────────────────────────────────┤
│                                     │
│ [🏆 総杯数] [⚗️ 純アルコール] [⚡ ペース]│
│                                     │
│ 🏆 総杯数ランキング                  │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🥇 1位  田中太郎                │ │
│ │ ━━━━━━━━━━━━━━━━━━━ 8杯       │ │
│ │ 🍺🍺🍺🍺🍺🍺🍺🍺                   │ │
│ │ 純アルコール: 160.0g             │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🥈 2位  佐藤次郎                │ │
│ │ ━━━━━━━━━━━━━━━━━ 7杯          │ │
│ │ 🍺🍺🍺🍺🍺🍺🍺                     │ │
│ │ 純アルコール: 140.0g             │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🥉 3位  鈴木三郎                │ │
│ │ ━━━━━━━━━━━━━━ 6杯             │ │
│ │ 🍺🍺🍺🍺🍺🍺                       │ │
│ │ 純アルコール: 120.0g             │ │
│ └─────────────────────────────────┘ │
│                                     │
│    4位  山田花子     4杯            │
│    5位  高橋一郎     3杯            │
│                                     │
├─────────────────────────────────────┤
│ 📊 統計情報                          │
│                                     │
│ • 平均: 5.6杯/人                     │
│ • 合計: 28杯                         │
│ • 最多ドリンク: 生ビール(中) 15杯   │
│                                     │
└─────────────────────────────────────┘
```

### タブ切り替え

1. **🏆 総杯数**
   - 杯数の合計でランキング
   - プログレスバー表示
   - ドリンク絵文字で視覚化

2. **⚗️ 純アルコール量**
   - 純アルコール量(g)でランキング
   - 健康リスクの目安も表示
   - 適正飲酒量との比較

3. **⚡ 飲酒ペース**
   - 杯/時間でランキング
   - 「飲むのが早い人」が分かる
   - 時系列グラフ表示

### 視覚要素
- **メダル**: 🥇🥈🥉（1〜3位）
- **プログレスバー**: 最大値を100%として相対表示
- **ドリンク絵文字**: 杯数を視覚化
- **グラフ**: 時系列の飲酒ペース

### インタラクション
- タップでユーザーの詳細記録を表示
- 共有ボタンでスクショ共有（後ほど実装）

---

## アニメーション・インタラクション

### 1. カードのタップ
- React Native Reanimatedでスケール変化
- Expo Hapticsで触覚フィードバック

### 2. 承認アクション
- ボタンタップ時にアニメーション
- 承認数がリアルタイムで更新
- 必要数に達したら「✅ 承認完了！」の演出

### 3. ランキング表示
- 順位が変動したらハイライト
- プログレスバーはアニメーション

### 4. リアルタイム更新
- Supabase Realtimeで自動更新
- 新しい記録が追加されたら通知

---

## コンポーネント設計

### 共通コンポーネント

1. **EventCard** - イベントカード
   - props: event, onPress

2. **DrinkLogCard** - 飲酒記録カード
   - props: drinkLog, showApprovalStatus

3. **ParticipantRow** - 参加者行
   - props: user, rank, stats

4. **DrinkSelector** - ドリンク選択UI
   - props: onSelect, selectedDrink

5. **ApprovalCard** - 承認待ちカード
   - props: drinkLog, onApprove, onReject

6. **RankingCard** - ランキングカード
   - props: rank, user, value, maxValue

---

## 次のステップ

1. ✅ UI設計完了
2. ⬜ Zustandストアの拡張（イベント・承認機能）
3. ⬜ API関数の実装（lib/events.ts, lib/drink-logs.ts）
4. ⬜ 画面コンポーネントの実装
5. ⬜ Supabase Realtimeの統合

---

## デザインモック（参考）

実際の実装では、NativeWindのTailwindクラスを使用して以下のスタイルを実現：

- `bg-sky-500` - Primary色
- `rounded-xl` - 角丸
- `shadow-lg` - 影
- `flex-row items-center` - フレックスレイアウト
- `text-lg font-bold` - テキストスタイル

アニメーションはReanimatedの`useAnimatedStyle`と`withSpring`を活用。
